# Production Docker Compose Configuration
# This file is automatically generated on the server by GitHub Actions
# It's provided here for reference only

version: '3.8'

services:
  bot:
    # Image is pulled from GitHub Container Registry (GHCR)
    # Format: ghcr.io/username/go-telegram-bot:main
    image: ${IMAGE_TAG}
    container_name: telegram-bot

    # Restart policy: always restart unless explicitly stopped
    restart: unless-stopped

    # Load environment variables from .env file
    # .env is automatically created by GitHub Actions from Secrets
    env_file: .env

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"  # Maximum log file size: 10MB
        max-file: "3"    # Keep 3 log files (total ~30MB)

    # Health check configuration
    healthcheck:
      test: ["CMD", "pgrep", "-f", "bot"]
      interval: 30s      # Check every 30 seconds
      timeout: 10s       # Timeout after 10 seconds
      retries: 3         # Retry 3 times before marking unhealthy
      start_period: 40s  # Grace period for startup

# Notes:
# - No MongoDB service here (using MongoDB Atlas cloud database)
# - No port mapping needed (bot uses Telegram long polling)
# - .env file contains: TELEGRAM_TOKEN, MONGO_URI, BOT_OWNER_IDS, etc.
# - Image tag is set via environment variable during deployment
